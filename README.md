# Chapter 2-1. 클린코드와 리팩토링

## 기본과제: 더티코드 개선

이번 과제는 더티코드를 클린코드의 형태로 개선을 하는 과제입니다. 주어진 테스트를 통과하면서 원래 기능과 동일한 동작을 하는 코드를 만들어주세요. basic과제는 제공되는 더티코드를 클린코드와 리팩토링 원칙에 입각해서 더 나은 코드로 만들어보세요. 주어진 테스트를 참고삼아 좋은 이름, 좋은 모양, 좋은 구조를 가지는 코드로 만들어 보세요.

[필수조건]

- Prettier와 ESLint를 설치해서 적용할 것
- 테스트 코드 모두 통과할 것
- = 기존 기능과 동일하게 동작할 것
- = 어플리케이션 요구사항을 모두 만족할 것
    - 상품
        - 상품1 - 10,000원
        - 상품2 - 20,000원
        - 상품3 - 30,000원
    - 상품 관리
        - 상품을 장바구니에 추가할 수 있어야 한다.
        - 장바구니에서 상품을 제거할 수 있어야 한다.
        - 각 상품의 수량을 변경할 수 있어야 한다.
        - 재고가 부족한 상품은 장바구니에 담을 수 없습니다.
    - 가격 계산
        - 장바구니 내 모든 상품의 총액을 계산해야 한다.
        - 개별 상품의 가격과 수량에 따른 소계를 표시해야 한다.
        - 상품1 > 10개 이상 구매 시 10% 할인
        - 상품2 > 10개 이상 구매 시 15% 할인
        - 상품3 > 10개 이상 구매 시 20% 할인
        - 상품 종류와 상관 없이, 30개 이상 구매할 경우 25% 할인
        - 화요일에는 특별할인 10%
        - 임의의 시간마다 깜짝세일 20%, 추천세일 5%
    - 기본 기능
        - 장바구니에 상품 추가 기능
        - 장바구니에서 상품 제거 기능
        - 상품 수량 변경 기능
        - 장바구니 내역 조회 기능
        - 총액 계산 기능

## 심확과제: 유지보수 하기 좋은 코드만들기

심화과제는 **기본과제에서 작성한 코드를 기술고도화를 하는 것입니다.** 바닐라 자바스크립트로 되어 있는 코드를 유지보수하기에 유리한 기술스택(React + Typescript)으로 고도화 리팩토링을 진행해주세요.
우리의 목표는 앞으로 유지보수를 더 잘할 수 있도록 하기 위함입니다. 최소 React와 Typescript를 이용한 코드로 개선해주세요. 그 밖의 기술선택과 폴더/파일 구조, 테스트 코드등은 자유입니다.


## 과제 체크포인트

### 기본과제

- [x] 코드가 Prettier를 통해 일관된 포맷팅이 적용되어 있는가?
- [x] 적절한 줄바꿈과 주석을 사용하여 코드의 논리적 단위를 명확히 구분했는가?
- [x] 변수명과 함수명이 그 역할을 명확히 나타내며, 일관된 네이밍 규칙을 따르는가?
- [x] 매직 넘버와 문자열을 의미 있는 상수로 추출했는가?
- [x] 중복 코드를 제거하고 재사용 가능한 형태로 리팩토링했는가?
- [ ] 함수가 단일 책임 원칙을 따르며, 한 가지 작업만 수행하는가?
- [ ] 조건문과 반복문이 간결하고 명확한가? 복잡한 조건을 함수로 추출했는가?
- [ ] 코드의 배치가 의존성과 실행 흐름에 따라 논리적으로 구성되어 있는가?
- [x] 연관된 코드를 의미 있는 함수나 모듈로 그룹화했는가?
- [x] ES6+ 문법을 활용하여 코드를 더 간결하고 명확하게 작성했는가?
- [x] 전역 상태와 부수 효과(side effects)를 최소화했는가?
- [ ] 에러 처리와 예외 상황을 명확히 고려하고 처리했는가?
- [ ] 코드 자체가 자기 문서화되어 있어, 주석 없이도 의도를 파악할 수 있는가?
- [ ] 비즈니스 로직과 UI 로직이 적절히 분리되어 있는가?
- [ ] 코드의 각 부분이 테스트 가능하도록 구조화되어 있는가?
- [ ] 성능 개선을 위해 불필요한 연산이나 렌더링을 제거했는가?
- [ ] 새로운 기능 추가나 변경이 기존 코드에 미치는 영향을 최소화했는가?
- [ ] 리팩토링 시 기존 기능을 그대로 유지하면서 점진적으로 개선했는가?
- [x] 코드 리뷰를 통해 다른 개발자들의 피드백을 반영하고 개선했는가?

### 심화과제

- [x] 변경한 구조와 코드가 기존의 코드보다 가독성이 높고 이해하기 쉬운가?
- [x] 변경한 구조와 코드가 기존의 코드보다 기능을 수정하거나 확장하기에 용이한가?
- [x] 변경한 구조와 코드가 기존의 코드보다 테스트를 하기에 더 용이한가?
- [ ] 변경한 구조와 코드가 기존의 모든 기능은 그대로 유지했는가?
- [ ] 변경한 구조와 코드를 새로운 한번에 새로만들지 않고 점진적으로 개선했는가?


## 과제 셀프회고

<!-- 과제에 대한 회고를 작성해주세요 -->

코드가 하나도 읽히지 않았다. 개발자로 회사를 다녀보지 않아서 남의 코드를 읽을 일이 없었는데 팀원들과 코드리뷰를 진행하고 이번 과제를 진행하며 코드를 구현하는 것보다 읽는게 더 중요하다는 것을 알게되었다. 코드를 읽는 능력의 부족함을 느끼며, 앞으로.. 이직을 하려면 더 많은 노력을 해야겠다고 생각했다.

기능 구현 과제는 테스트 하나가 완료될 때마다 성취감이 있었는데 리팩토링은 100퍼센트 정답이 없는 코드에 대해 판단하고 선택해야 하는 과정이 나를 너무 지치고 자괴감에 빠지게 만들었다. 따라, 협업의 중요성을 다시 한번 느꼈다. 내가 맞나 하는 생각과 내 코드가 부끄러워서 코드 리뷰를 미뤄왔지만 계속해서 논의하며 코드 리뷰를 받는 것이 더 나은 해결책을 찾는 것임을, 또한 의견을 나누며 나의 역량과 팀 전체의 역량을 높일 수 있음을 생각하며 더 큰 가치를 제공할 수 있도록 열심히 하고 싶다.

### 과제에서 좋았던 부분

사실 리팩토링 해야지 해야지 하며 미뤄둔 적이 많았는데 과제를 하며 기능 분리에 대해 고민할 기회를 얻었고, 다양한 관점에서 코드를 바라볼 수 있었다.

### 과제를 하면서 새롭게 알게된 점

코드 읽기의 중요성을 알게 되었다. 내가 리팩토링을 진행하는 것도 중요하지만, 지금은 코드를 읽고 이해하는 것도 잘 정리가 안되어 구현하는 것보다 읽는 것이 중요하구나, 단순히 줄바꿈으로 코드를 깔끔하게 정리하는 것이 아니라 기능 분리를 통해 가독성과 유지보수성이 크게 향상될 수 있구나라는 것을 깨달았다.

### 과제를 진행하면서 아직 애매하게 잘 모르겠다 하는 점, 혹은 뭔가 잘 안되서 아쉬운 것들

코드를 읽는 것이 너무 어려웠다. 어디부터 어떻게 읽어가야할지 감이 오지 않았고, 기능을 완벽하게 분리하지 못했다. 심화과제가 React로 구현하는 것이어서 기본 과제를 진행할 때도 비슷한 맥락으로 리팩토링을 진행하려 노력했고 상태관리, 서비스를 중점으로 진행 하려했다. 하지만,,, 완벽하게 이루어지지 않았다. 전체적인 맥락, 어떤 서비스인지 이해했어도 얼마나 결합도가 있는 것인지 이 부분은 하나의 기능만 수행하는 함수인지 단방향성인지에 대한 감이 잡히지 않았다. 뭐라도 다르게 해보려고 시도했던 것들이 오히려 더 코드를 더러워지게 하는 것도 같아 어려웠다. 

지금 내가 리팩토링(했다고 말할 수 있을까..?)한 코드는 나한테 익숙해져서 잘 읽히지만 다른 사람이 보았을 때는 전혀 읽히지 않을 것 같다. 또한, 자주 바뀔 것들이 위로 자주 바뀌지 않는 것들이 아래로 갈 수 있게 흐름을 짜보려 했지만 바뀐다는 것이 정확히 무엇인지 파악을 못한 것 같다.

마지막으로.. 타입스크립트.. 3주차부터 계속 그것이 너무 아쉽다. AI의 도움을 받긴 했지만 아직 100퍼센트 이해한 것이 아니라 이번 과제에서도 아쉬움으로 여전히 남아있다.

## 리뷰 받고 싶은 내용이나 궁금한 것에 대한 질문

저는 처음 코드를 파악하는 것이 어려워 책을 읽을 때 첫 페이지만 계속 읽듯 같은 곳만 반복하였는데 코드 베이스를 처음 파악할 때, 주로 어느 부분부터 읽기 시작하면 좋을지 궁금합니다. (일단 읽히지 않더라도 읽어가야하는 것인지..)

<질문 답변>
1. 코드베이스 파악 순서
- 먼저 package.json을 보고 프로젝트의 전반적인 구조와 의존성 파악
- 진입점(index.js, App.js 등)부터 시작해 전체적인 흐름을 따라가기
- 핵심 비즈니스 로직이 있는 파일 위주로 파악
- 테스트 코드가 있다면 이를 통해 기능 요구사항 유추


코드가 복잡하게 얽혀 있고 어디서부터 손을 대야 할지 몰라 변수명도 수정했다가 다시 비즈니스 로직을 보았다가 UI를 보았다가 왔다갔다 작업을 진행했습니다. 팀원들과 코드리뷰를 진행할 때도 각자 다른 방식으로 접근하여, 코치님은 리팩토링을 할 때 어떤 방식으로 접근하시는지 궁금합니다. 

<질문 답변>
2. 리팩토링 접근 방식
- 먼저 현재 코드에 대해 테스트를 작성하기
- 큰 구조부터 작은 부분으로 접근합니다:
  1) 아키텍처 레벨 분리 (비즈니스 로직, UI 등)
  2) 모듈/컴포넌트 레벨 분리
  3) 함수 레벨 리팩토링
  4) 변수명, 포맷팅 등 스타일 수정
- 한 번에 한 가지 문제만 해결하기

지금 코드는 이름 짓기, 함수 분리, 상수화, 관심사 분리 등이 잘 되어있으나, 새로운 요구사항이 추가될 때 고려해볼 사항들이 있습니다.

1. 할인 로직이 discountService에 집중되어 있어, 새로운 할인 정책이 추가될 때마다 이 서비스를 수정해야 합니다. 할인 정책별로 클래스를 분리하고 전략 패턴을 적용하면 더 유연한 구조가 될 것 같습니다.
2. 프로모션 이벤트 로직이 시간 기반으로 되어있어, 다른 조건(예: 특정 회원 등급)의 프로모션을 추가하기 어려울 수 있습니다. 이벤트 조건을 추상화하면 좋을 것 같습니다.

심화과제의 useCart 도 동일한 문제를 가지고 있답니다!

<!--
피드백 받고 싶은 내용을 구체적으로 남겨주세요
모호한 요청은 피드백을 남기기 어렵습니다.

참고링크: https://chatgpt.com/share/675b6129-515c-8001-ba72-39d0fa4c7b62

모호한 요청의 예시)
- 코드 스타일에 대한 피드백 부탁드립니다.
- 코드 구조에 대한 피드백 부탁드립니다.
- 개념적인 오류에 대한 피드백 부탁드립니다.
- 추가 구현이 필요한 부분에 대한 피드백 부탁드립니다.

구체적인 요청의 예시)
- 현재 함수와 변수명을 보면 직관성이 떨어지는 것 같습니다. 함수와 변수를 더 명확하게 이름 지을 수 있는 방법에 대해 조언해주실 수 있나요?
- 현재 파일 단위로 코드가 분리되어 있지만, 모듈화나 계층화가 부족한 것 같습니다. 어떤 기준으로 클래스를 분리하거나 모듈화를 진행하면 유지보수에 도움이 될까요?
- MVC 패턴을 따르려고 했는데, 제가 구현한 구조가 MVC 원칙에 맞게 잘 구성되었는지 검토해주시고, 보완할 부분을 제안해주실 수 있을까요?
- 컴포넌트 간의 의존성이 높아져서 테스트하기 어려운 상황입니다. 의존성을 낮추고 테스트 가능성을 높이는 구조 개선 방안이 있을까요?
-->
